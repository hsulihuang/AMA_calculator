<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMA Calculator</title>
</head>
<body>
    <h1>AMA Calculator</h1>
    <form action="/calculate" method="post">
        <!-- Impairment Standard -->
        <label for="impairment_standard">Impairment Standard:</label>
        <input type="text" id="impairment_standard" name="impairment_standard"><br><br>

        <!-- Category -->
        <label for="category">Category:</label>
        <select id="category" name="category">
            <option value="">Select Category</option>
            {% for category in categories %}
            <option value="{{ category }}">{{ category }}</option>
            {% endfor %}
        </select><br><br>

        <!-- Impairment Number -->
        <label for="impairment_number">Impairment Number:</label>
        <select id="impairment_number" name="impairment_number">
            <option value="">Select Impairment Number</option>
        </select><br><br>

        <!-- Occupational Group -->
        <label for="occupational_group">Occupational Group:</label>
        <input type="text" id="occupational_group" name="occupational_group"><br><br>

        <!-- Age -->
        <label for="age">Age:</label>
        <input type="text" id="age" name="age"><br><br>

        <!-- Submit Button -->
        <input type="submit" value="Calculate">
    </form>

    <script>
        document.getElementById('category').addEventListener('change', function() {
            const selectedCategory = this.value;
            console.log(`Selected Category: ${selectedCategory}`);
            
            const impairmentDropdown = document.getElementById('impairment_number');
            impairmentDropdown.innerHTML = '<option value="">Select Impairment Number</option>';
        
            if (selectedCategory) {
                fetch(`/get_impairment_numbers?category=${selectedCategory}`)
                    .then(response => response.json())
                    .then(data => {
                        console.log("Data received:", data);
                        data.forEach(item => {
                            const option = document.createElement('option');
                            option.value = item.Impairment_Number;
                            option.text = item.Impairment_Number;
                            impairmentDropdown.appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.error("Error fetching impairment numbers:", error);
                    });
            }
        });
    </script>    
</body>
</html>
